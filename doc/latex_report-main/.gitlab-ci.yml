# To contribute improvements to CI/CD templates, please follow the Development guide at:
# https://docs.gitlab.com/ee/development/cicd/templates.html
# This specific template is located at:
# https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/LaTeX.gitlab-ci.yml

---
variables:
  # Feel free to choose the image that suits you best.
  # blang/latex:latest ... Former image used in this template. No longer maintained by author.
  # listx/texlive:2020 ... The default, referring to TexLive 2020. Current at least to 2021-02-02.

  # Additional alternatives with high Docker pull counts:
  # thomasweise/docker-texlive-full
  # thomasweise/texlive
  # adnrv/texlive
  LATEX_IMAGE: listx/texlive:2020
  LATEX_MAIN: report.tex
stages:
  - build
  - release

build_job:
  stage: build
  image: $LATEX_IMAGE
  tags:
    - alpine-docker
  script:
    - latexmk -pdf $LATEX_MAIN
  artifacts:
    paths:
      - "*.pdf"

release_job:
  stage: release
  needs:
    - job: build_job
      artifacts: true
  tags:
   - alpine-docker
  image: registry.gitlab.com/gitlab-org/release-cli:latest
  rules:
    - if: $CI_COMMIT_TAG
      when: never
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
      # DEACTIVATED: current runner is outdated. Waiting for an update.
      when: never

  script:
    - echo "Running the release job."
  release:
    tag_name: $CI_PIPELINE_IID
    description: 'Release created using the release-cli.'